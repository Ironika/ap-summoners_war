import AppHelper from 'helpers/AppHelper'
import AuthHelper from 'helpers/AuthHelper'
import ImageHelper from 'helpers/ImageHelper'
import UserHelper from 'helpers/UserHelper'
import { BaseData, Utils } from 'ap-react-bootstrap'

let PAGES = {
    import: 'import',
    monsters: 'monsters',
    runes: 'runes',
    builds: 'builds'
}

/* This class was auto-generated by the JavaScriptWriter */
class AppData extends BaseData {

	register(obj) {
		super.register(obj)

		this.obj.onClickHome = this.onClickHome
		this.obj.onClickProfile = this.onClickProfile

		Utils.forEach(PAGES, function(page) {
			this.obj[page] = this.onClickPage.bind(this, PAGES[page])
		}.bind(this))

		this.obj.state = {
			username: 'Homunculus',
			profileImage: 'assets/images/monsters/Homunculus-Awakened_Fire.jpg',
			isLogged: false
		}

		UserHelper.register(this, this.buildDataUser.bind(this))
        ImageHelper.register(this, this.buildDataAvatar.bind(this))
	}

	unregister() {
		UserHelper.unregister(this)
	}

	buildDataUser() {
        let username = UserHelper.getData(AuthHelper.getEntityId() + '/username')
        
        let profileImage = UserHelper.getData(AuthHelper.getEntityId() + '/profileImage')
        let img = ImageHelper.getData(profileImage)
        if (profileImage && !img) {
            ImageHelper.getImage(profileImage)
        }

		this.setState({
            username: username || 'Homunculus',
            isLogged: true
        })
	}

    buildDataAvatar() {
        let profileImage = UserHelper.getData(AuthHelper.getEntityId() + '/profileImage')
        if (profileImage) {
            let img = ImageHelper.getData(profileImage)
            if (img) {
                this.setState({
                    profileImage: img.src,
                })    
            }
        }
    }

	onClickHome() {
		AppHelper.navigate('/');
	}

	onClickProfile() {
		AppHelper.navigate('/profile');
	}

	onClickPage(page) {
		this.obj.setState({activePage: page})
		AppHelper.navigate('/' + page);
	}

}
var AppObj = new AppData();
AppObj.PAGES = PAGES
export default AppObj;

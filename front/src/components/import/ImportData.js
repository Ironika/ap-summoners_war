import AppHelper from 'helpers/AppHelper';
import AuthHelper from 'helpers/AuthHelper';
import DefaultHelper from 'helpers/DefaultHelper';
import { BaseData }  from 'ap-react-bootstrap'

/* This class was auto-generated by the JavaScriptWriter */
class ImportData extends BaseData {

	register(obj) {
		super.register(obj)

		this.obj.onClickImport = this.onClickImport.bind(this)

		this.obj.state = {
			upload: "Upload your file",
			fileInput: {},
			error: "",
			success: ""
		}
	}

	unregister() {

	}

	onChange() {
		this.setState({upload: this.getState('fileInput').files[0].name, error: ""})
	}

	onClickImport() {
		this.setState({success: "Please wait..."});
		let f = this.getState('fileInput').files[0]; 

	    if (f) {
	      	let r = new FileReader();
	      	r.onload = function(e) { 
			    let contents = e.target.result;
			   	DefaultHelper.postUserImport({
			    	data: contents, 
			    	userId: AuthHelper.getEntityId()
			    }).then(
			    	this.setState({success: "The file has been loaded !"})
			    )
	      	}.bind(this)
	      	r.readAsText(f);
	    } else { 
	      	this.setState({error: "Failed to load the file"});
	    }
	}


}
var ImportObj = new ImportData();
export default ImportObj;
